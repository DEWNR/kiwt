{% from 'macros/helpers.html' import sprite %}

{% set image_path = 'images/' %}
{% set share_path = 'http://www.environment.sa.gov.au/files/templates/00000000-0000-0000-0000-000000000000/f88a7f3c-df7e-430a-825c-24cfa8dec9a8/' %}
{% set site_prefix = 'kiwt' %}
{% set site_url = 'http://www.environment.sa.gov.au' %}
{% set bookeasy_key = 'd5192d41822d0c987a0610af120d29bf' %}

<!doctype html>
<html>
<head>

    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1.0">

    <title>{% block title %}Department of Environment, Water and Natural Resources (DEWNR){% endblock %}</title>


    <!-- Scripts -->

    <script type="text/javascript" src="//fast.fonts.net/jsapi/e0cc203f-7221-4daf-a2d5-815483dba107.js" async></script>


    <!-- Stylesheets -->

    <link href="css/main.css" rel="stylesheet">

    <noscript>

        <link type="text/css" rel="stylesheet" href="//fast.fonts.net/cssapi/e0cc203f-7221-4daf-a2d5-815483dba107.css">

    </noscript>

    <!-- End Stylesheets -->

    {% block head %}{% endblock %}

</head>
<body>


    <div class="site-wrap">

        {% include "shared/global-header.html" %}

        {% include "shared/site-header.html" %}

        <div class="content">

            {% include "shared/site-hero.html" %}

            <main role="main">
                {% block content %}
                {% endblock %}
            </main>

            {% include "shared/cta-strip.html" %}

            {% include "shared/navigation-tiles.html" %}

            {% include "shared/site-footer.html" %}

        </div><!-- /.content -->


    </div><!-- /.site-wrap -->


    {% block javascript %}

        <!-- jQuery -->

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="js/jquery.columnizer.js"></script>
        <script src="js/color-thief.js"></script>

        <!-- Local fallback -->

        <script>window.jQuery || document.write('<script src="/files/templates/00000000-0000-0000-0000-000000000000/f88a7f3c-df7e-430a-825c-24cfa8dec9a8/jquery1111min.js">\x3C/script>')</script>

        <!-- End local fallback -->

        <!-- End jQuery -->


        <script>

            var sh = $('.site-header');

            $(window).scroll(function() {
                // parallax();

                if($(this).scrollTop() > 51) {
                    sh.addClass('is-fixed');
                } else {
                    sh.removeClass('is-fixed');
                }
            });
            //
            // function parallax(){
            //     var scrolled = $(window).scrollTop();
            //     $('.site-hero').css('top',-(scrolled*0.0315)+'rem');
            //     $('.site-hero__title').css('top',-(scrolled*-0.005)+'rem');
            //     $('.site-hero__title').css('opacity',1-(scrolled*.00175));
            // };


            $(document).ready(function() {
                bAutoColours = 0;

                // split article column ground into two
                $('.article-cards--columns').columnize({
                    columns: 2,
                    lastNeverTallest: true,
                    doneFunc: function(){
                        $('.last.column .article-card').last().height($('.last.column .article-card').last().height() + ($('.first.column').height() - $('.last.column').height()));
                    }
                });

                if (bAutoColours) {
                    // color article-card backgrounds
                    $('.article-card__image').each(function() {

                        var colorThief = new ColorThief();
                        var $theImage = $(this).find('img');

                        //Grabs 8 swatch color palette from image and sets quality to 5 (0 =slow, 10=default/fast)
                        var cp = colorThief.getPalette($theImage[0], 10, 5);

                        //Sets background to 3rd color in the palette.
                        $(this).parent().css('background-color', 'rgba('+cp[6][0]+','+cp[6][1]+','+cp[6][2]+', 0.3)');

                    });
                }

                function rgbToHsl(r, g, b){
                    r /= 255, g /= 255, b /= 255;
                    var max = Math.max(r, g, b), min = Math.min(r, g, b);
                    var h, s, l = (max + min) / 2;

                    if(max == min){
                        h = s = 0; // achromatic
                    }else{
                        var d = max - min;
                        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                        switch(max){
                            case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                            case g: h = (b - r) / d + 2; break;
                            case b: h = (r - g) / d + 4; break;
                        }
                        h /= 6;
                    }

                    return [h, s, l];
                }
            });
        </script>

        <script src="//gadgets.impartmedia.com/gadgets.jsz?key={{ bookeasy_key }}"></script>

        <script>

            var bAllowBookings = true;
            var bookeasyData = {};
            var bookeasyType = 'accom'; // defaults to accomodation
            var bookingDate = new Date(); // get today's date
            // var operatorIDs = productID = [75605]; // set operatorIDs to display
            var operatorIDs = productID = [80122]; // set operatorIDs to display
            var operatorIDString = operatorIDs.join(); // create a string for the JSONP request
            var operatorPageType = 'tours'; // type of operator

            if (operatorPageType == 'tours') {
                bookeasyType = 'tours';
            }

            $(function() {

                getOperatorData();

                // load details gadget
                BE.gadget.details('#bookeasy__details-gadget', {
                    defaultDate: bookingDate,
                    descriptionHover: true,
                    period: 1,
                    productID: productID,
                    showHoverInline: true,
                    showQuantity: false,
                    thumbsInGrid: true,
                    type: bookeasyType,
                    vcID: 188
                });

                // load card gadget
                BE.gadget.cart('#bookeasy__cart-gadget', {
                    autoCollapse: true,
                    bookingURL: './checkout.html',
                    vcID: 188
                });

                $('.details-gadget .thumb').on('click', function() {
                    console.log('clicked');
                });

            });

            function getOperatorData() {

                $.ajax({
                    url: '//sjp.impartmedia.com/be/getOperatorsDetailsShort?q=188&operators=' + operatorIDString,
                    cache: true,
                    dataType: 'jsonp',
                    jsonpCallback: 'jQueryOperatorsInformation'
                })
                .done(function(data) {

                    if (data.length) {

                        // insert t&c information
                        var cancellationPolicy = data[0].CancellationPolicy;

                        $('#bookeasy__conditions').html('<h3>Terms and conditions</h3>' + text2HTML(cancellationPolicy));
                    }

                })

            }

            function text2HTML(input) {
              input = input.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/\//g, '/');
              input = input.replace(/\r/g, '').replace(/\n( )*?(\n)*?( )*?$/, '').replace(/\n( )*?\n/g, '</p><p>').replace(/\n/g, '<br />');
              input = '<p>'+input+'</p>';
              return input;
            }

        </script>
    {% endblock %}

    {% block local_javascript %}{% endblock %}


</body>
</html>
